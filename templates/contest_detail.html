{% extends "layout/basic.html" %}
{% import "components/contest.html" as contest with context %}
{% import "components/record.html" as record with context %}
{% import "components/problem.html" as problem with context %}
{% block content %}
{{ set(UiContext, 'tdoc', tdoc) }}
{{ set(UiContext, 'tsdoc', tsdoc) }}
<div class="row">
  <div class="medium-9 columns">
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ tdoc.title }}</h1>
      </div>
      <div class="section__body">
        <span class="bp5-tag bp5-large bp5-minimal problem__tag-item">{{ _(model.contest.statusText(tdoc, tsdoc)) }}</span>
        <span class="bp5-tag bp5-large bp5-minimal problem__tag-item icon icon-award">{{ _(model.contest.RULES[tdoc.rule].TEXT) }}</span>
        <span class="bp5-tag bp5-large bp5-minimal problem__tag-item">{{ _('Start at') }}: {{ contest.render_time(tsdoc.startAt or tdoc.beginAt) }}</span>
        <span class="bp5-tag bp5-large bp5-minimal problem__tag-item icon icon-schedule">{{ contest.render_duration(tdoc) }} {{ _('hour(s)') }}</span>
        <span class="bp5-tag bp5-large bp5-minimal problem__tag-item">{{ _('Host') }}: {{ user.render_inline(udict[tdoc.owner], badge=false) }}</span>
        <span class="bp5-tag bp5-large bp5-minimal problem__tag-item icon icon-user--multiple">{{ tdoc['attend']|default(0) }}</span>
        {% if tsdoc.attend %}
          <span class="bp5-tag bp5-large bp5-minimal problem__tag-item icon icon-check">{{ _('Attended') }}</span>
        {% endif %}
        
        {% if setting and setting.enabled %}
          <span class="bp5-tag bp5-large bp5-minimal problem__tag-item ipcontrol-security-tag">
            <i class="icon icon-security"></i> IP控制已启用
          </span>
        {% endif %}
      </div>
    </div>
    <div class="section">
      <div class="section__body typo richmedia">
        {{ tdoc['content']|markdown|safe }}
      {% if model.contest.isOngoing(tdoc, tsdoc) %}
        <blockquote class="warn">
          <p>{{ _('We will check code similarity after this contest.') }}</p>
        </blockquote>
      {% endif %}
      {% if tdoc.duration %}
        <blockquote class="note">
          <p>{{ _('The contest is a flexible time contest. You need to complete the contest within a specified time after you attended.') }}</p>
        </blockquote>
      {% endif %}
      {% if setting and setting.enabled %}
        <blockquote class="warn">
          <p><strong>IP控制通知:</strong></p>
          <ul>
            <li>此比赛已启用IP控制</li>
            <li>比赛开始前{{ setting.preContestLockMinutes || 60 }}分钟内将禁止登录</li>
            <li>比赛期间，您必须使用与首次登录相同的IP地址和浏览器</li>
            <li>任何来自不同IP/浏览器的登录尝试都将被阻止</li>
            {% if setting.strictMode %}
            <li>严格模式：将同时检查IP地址和浏览器指纹</li>
            {% else %}
            <li>宽松模式：仅检查IP地址</li>
            {% endif %}
          </ul>
        </blockquote>
      {% endif %}
      </div>
    </div>
    {% if tdoc.files.length %}
      <div class="section">
        <div class="section__header">
          <h1 class="section__title">{{ _('Files') }}</h1>
        </div>
        {% include "partials/files.html" %}
      </div>
    {% endif %}
  </div>
  <div class="medium-3 columns">
  {% set owner_udoc = udict[tdoc.owner] %}
  {% include "partials/contest_sidebar.html" %}
  {% include "partials/contest_ip_control_sidebar.html" %}
  </div>
</div>

<style>
.ipcontrol-security-tag {
  background: #ff7675 !important;
  color: white !important;
}

.ipcontrol-security-tag .icon {
  color: white;
}
</style>
{% endblock %}
