{% extends "layout/basic.html" %}
{% block title %}IP 控制管理 - {{ contest.title }}{% endblock %}
{% block content %}
<div class="ipc-container">
  <h2 class="ipc-title">比赛 IP 控制管理</h2>
  <div class="ipc-section">
    <div><strong>比赛:</strong> {{ contest.title }} (ID: {{ contest._id }})</div>
    <div><strong>开始时间:</strong> {{ beginAtStr }}</div>
    <div><strong>结束时间:</strong> {{ endAtStr }}</div>
    <div><strong>IP 控制状态:</strong>
      {% if contest.ipControlEnabled %}<span class="ipc-status-on">已开启</span>{% else %}<span class="ipc-status-off">未开启</span>{% endif %}
    </div>
    <form method="post" class="ipc-form-toggle">
      <input type="hidden" name="action" value="toggle"/>
      <input type="hidden" name="enabled" value="{{ not contest.ipControlEnabled }}"/>
      <button type="submit" class="ipc-btn ipc-btn-toggle">{% if contest.ipControlEnabled %}关闭{% else %}开启{% endif %} IP 控制</button>
    </form>
  </div>
  <div class="ipc-section">
    <h3 class="ipc-subtitle">导入参赛 UID</h3>
    <p class="ipc-tip">批量导入将设置这些用户 attend=1；支持换行/空格/逗号分隔。</p>
    <form method="post" class="ipc-form-import">
      <input type="hidden" name="action" value="import_uids"/>
      <textarea name="uidsText" class="ipc-textarea" rows="6" placeholder="例如: 1001 1002 1003\n或每行一个 UID"></textarea>
      <div class="ipc-form-actions">
        <button type="submit" class="ipc-btn ipc-btn-primary">导入</button>
      </div>
    </form>
    <div class="ipc-meta">当前已记录参赛人数（status.attend=1）：{{ imported }}</div>
  </div>
  <div class="ipc-section ipc-notes">
    <h3 class="ipc-subtitle">说明</h3>
    <ul class="ipc-list">
      <li>开启后：比赛开始前 1 小时内禁止参赛用户登录，并强制踢下线。</li>
      <li>比赛进行中：首次登录绑定 IP+UA，后续变更将被拒绝。</li>
      <li>未参加任何开启 IP 控制的比赛的用户不受影响。</li>
    </ul>
  </div>
</div>
<style>
.ipc-container{max-width:860px;margin:30px auto;padding:20px;background:#1f1f24;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.3);} .ipc-title{margin:0 0 15px;font-size:24px;color:#fff;font-weight:600;} .ipc-section{margin-top:22px;padding:16px 18px;background:#26262c;border:1px solid #333;border-radius:6px;} .ipc-subtitle{margin:0 0 12px;font-size:18px;color:#e0e0e0;font-weight:500;} .ipc-status-on{color:#4caf50;font-weight:600;} .ipc-status-off{color:#f44336;font-weight:600;} .ipc-form-toggle{margin-top:10px;} .ipc-btn{cursor:pointer;border:none;border-radius:4px;padding:8px 16px;font-size:14px;line-height:1.3;} .ipc-btn-toggle{background:#444;color:#eee;} .ipc-btn-toggle:hover{background:#555;} .ipc-btn-primary{background:#1976d2;color:#fff;} .ipc-btn-primary:hover{background:#1e88e5;} .ipc-textarea{width:100%;resize:vertical;background:#1a1a1f;color:#ddd;border:1px solid #444;border-radius:4px;padding:8px;font-family:monospace;} .ipc-form-actions{margin-top:10px;} .ipc-tip{font-size:12px;color:#999;margin:4px 0 8px;} .ipc-meta{margin-top:10px;font-size:13px;color:#bbb;} .ipc-list{margin:0;padding-left:18px;color:#c7c7c7;font-size:13px;line-height:1.5;} .ipc-notes li{margin-bottom:4px;}
</style>
{% endblock %}
